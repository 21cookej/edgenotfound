class t{constructor(t,e){this.minFrameLength=t,this.maxFrameLength=e,this.lastUpdate=new Date,this.currentFrameLength=0,this.stepsProcessed=0,this.timePlaying=0}update(t=null){const e=new Date;this.currentFrameLength=t||(e-this.lastUpdate)/1e3,this.lastUpdate=e,this.timePlaying+=this.currentFrameLength,this.stepsProcessed+=1}fps(){return 1/this.currentFrameLength}perSecond(t){return t*this.currentFrameLength}}const e={IDLE:0,PRESSED:1,HELD:2,RELEASED:3};class n{constructor(t,n=null,r=null,a=0,h=0){this.delta=0,this.posKeysHeld=[],this.negKeysHeld=[],this.timer=r,this.prevHeldTime=0,this.heldTime=0,this.fired=!1,this.waitForRefiring=a,this.firstWaitForRefiring=a+h,this.timeSinceLastRefire=0,this.timesFired=0,this.state=e.IDLE,t&&t.forEach(t=>{window.addEventListener("keydown",e=>{if(this.change(e,t)){var n=i(this.posKeysHeld,t);n.changed&&(this.posKeysHeld=n.array,this.updateDelta())}}),window.addEventListener("keyup",e=>{this.change(e,t)&&(this.posKeysHeld=s(this.posKeysHeld,t),this.updateDelta())})}),this.positiveKeys=t,n&&n.forEach(t=>{window.addEventListener("keydown",e=>{if(this.change(e,t)){var n=i(this.negKeysHeld,t);n.changed&&(this.negKeysHeld=n.array,this.updateDelta())}}),window.addEventListener("keyup",e=>{this.change(e,t)&&(this.negKeysHeld=s(this.negKeysHeld,t),this.updateDelta())})}),this.negativeKeys=n}change(t,e){return t.code==e||t.keyCode==e}updateDelta(){const t=this.posKeysHeld.length-this.negKeysHeld.length;t>0&&1!=this.delta?(this.delta=1,this.heldTime=0,this.timesFired=0,this.timeSinceLastRefire=0):t<0&&-1!=this.delta?(this.delta=-1,this.heldTime=0,this.timesFired=0,this.timeSinceLastRefire=0):0!=this.delta&&(this.delta=0,this.heldTime=0,this.timesFired=0,this.timeSinceLastRefire=0)}update(){this.timer&&0!=this.delta?(this.heldTime+=this.timer.currentFrameLength,this.timeSinceLastRefire+=this.timer.currentFrameLength,0==this.prevHeldTime||this.timesFired>1&&this.timeSinceLastRefire>=this.waitForRefiring||this.timesFired<=1&&this.timeSinceLastRefire>=this.firstWaitForRefiring?(this.fired=!0,this.timesFired+=1,this.timeSinceLastRefire=0):this.fired=!1):this.fired=!1,0==this.delta?0!=this.prevHeldTime?this.state=e.RELEASED:this.state=e.IDLE:0==this.prevHeldTime?this.state=e.PRESSED:this.state=e.HELD,this.prevHeldTime=this.heldTime}}function r(t,e,n){return Math.max(e,Math.min(t,n))}function i(t,e){var n=!1;return-1===t.indexOf(e)&&(t.push(e),n=!0),{array:t,changed:n}}function s(t,e){const n=t.indexOf(e);return n>-1&&t.splice(n,1),t}var a=function(){function t(t,e,n){if(t&&t.length){const[r,i]=e,s=Math.PI/180*n,a=Math.cos(s),h=Math.sin(s);t.forEach(t=>{const[e,n]=t;t[0]=(e-r)*a-(n-i)*h+r,t[1]=(e-r)*h+(n-i)*a+i})}}function e(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function n(t,e,n,r){const i=e[1]-t[1],s=t[0]-e[0],a=i*t[0]+s*t[1],h=r[1]-n[1],o=n[0]-r[0],l=h*n[0]+o*n[1],f=i*o-h*s;return f?[(o*a-s*l)/f,(i*l-h*a)/f]:null}function r(t,e,n){const r=t.length;if(r<3)return!1;const h=[Number.MAX_SAFE_INTEGER,n],o=[e,n];let l=0;for(let e=0;e<r;e++){const n=t[e],f=t[(e+1)%r];if(a(n,f,o,h)){if(0===s(n,o,f))return i(n,o,f);l++}}return l%2==1}function i(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}function s(t,e,n){const r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return 0===r?0:r>0?1:2}function a(t,e,n,r){const a=s(t,e,n),h=s(t,e,r),o=s(n,r,t),l=s(n,r,e);return a!==h&&o!==l||!(0!==a||!i(t,n,e))||!(0!==h||!i(t,r,e))||!(0!==o||!i(n,t,r))||!(0!==l||!i(n,e,r))}function h(e,n){const r=[0,0],i=Math.round(n.hachureAngle+90);i&&t(e,r,i);const s=function(t,e){const n=[...t];n[0].join(",")!==n[n.length-1].join(",")&&n.push([n[0][0],n[0][1]]);const r=[];if(n&&n.length>2){let t=e.hachureGap;t<0&&(t=4*e.strokeWidth),t=Math.max(t,.1);const i=[];for(let t=0;t<n.length-1;t++){const e=n[t],r=n[t+1];if(e[1]!==r[1]){const t=Math.min(e[1],r[1]);i.push({ymin:t,ymax:Math.max(e[1],r[1]),x:t===e[1]?e[0]:r[0],islope:(r[0]-e[0])/(r[1]-e[1])})}}if(i.sort((t,e)=>t.ymin<e.ymin?-1:t.ymin>e.ymin?1:t.x<e.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax)),!i.length)return r;let s=[],a=i[0].ymin;for(;s.length||i.length;){if(i.length){let t=-1;for(let e=0;e<i.length&&!(i[e].ymin>a);e++)t=e;i.splice(0,t+1).forEach(t=>{s.push({s:a,edge:t})})}if((s=s.filter(t=>!(t.edge.ymax<=a))).sort((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x)),s.length>1)for(let t=0;t<s.length;t+=2){const e=t+1;if(e>=s.length)break;const n=s[t].edge,i=s[e].edge;r.push([[Math.round(n.x),a],[Math.round(i.x),a]])}a+=t,s.forEach(e=>{e.edge.x=e.edge.x+t*e.edge.islope})}}return r}(e,n);return i&&(t(e,r,-i),function(e,n,r){const i=[];e.forEach(t=>i.push(...t)),t(i,n,r)}(s,r,-i)),s}class o{constructor(t){this.helper=t}fillPolygon(t,e){return this._fillPolygon(t,e)}_fillPolygon(t,e,n=!1){let r=h(t,e);if(n){const e=this.connectingLines(t,r);r=r.concat(e)}return{type:"fillSketch",ops:this.renderLines(r,e)}}renderLines(t,e){const n=[];for(const r of t)n.push(...this.helper.doubleLineOps(r[0][0],r[0][1],r[1][0],r[1][1],e));return n}connectingLines(t,n){const r=[];if(n.length>1)for(let i=1;i<n.length;i++){const s=n[i-1];if(e(s)<3)continue;const a=[n[i][0],s[1]];if(e(a)>3){const e=this.splitOnIntersections(t,a);r.push(...e)}}return r}midPointInPolygon(t,e){return r(t,(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2)}splitOnIntersections(t,i){const s=Math.max(5,.1*e(i)),h=[];for(let r=0;r<t.length;r++){const o=t[r],l=t[(r+1)%t.length];if(a(o,l,...i)){const t=n(o,l,i[0],i[1]);if(t){const n=e([t,i[0]]),r=e([t,i[1]]);n>s&&r>s&&h.push({point:t,distance:n})}}}if(h.length>1){const e=h.sort((t,e)=>t.distance-e.distance).map(t=>t.point);if(r(t,...i[0])||e.shift(),r(t,...i[1])||e.pop(),e.length<=1)return this.midPointInPolygon(t,i)?[i]:[];const n=[i[0],...e,i[1]],s=[];for(let e=0;e<n.length-1;e+=2){const r=[n[e],n[e+1]];this.midPointInPolygon(t,r)&&s.push(r)}return s}return this.midPointInPolygon(t,i)?[i]:[]}}class l extends o{fillPolygon(t,e){return this._fillPolygon(t,e,!0)}}class f{constructor(t){this.helper=t}fillPolygon(t,e){const n=h(t,e=Object.assign({},e,{curveStepCount:4,hachureAngle:0,roughness:1}));return this.dotsOnLines(n,e)}dotsOnLines(t,n){const r=[];let i=n.hachureGap;i<0&&(i=4*n.strokeWidth),i=Math.max(i,.1);let s=n.fillWeight;s<0&&(s=n.strokeWidth/2);const a=i/4;for(const h of t){const t=e(h),o=t/i,l=Math.ceil(o)-1,f=t-l*i,c=(h[0][0]+h[1][0])/2-i/4,u=Math.min(h[0][1],h[1][1]);for(let t=0;t<l;t++){const e=u+f+t*i,h=this.helper.randOffsetWithRange(c-a,c+a,n),o=this.helper.randOffsetWithRange(e-a,e+a,n),l=this.helper.ellipse(h,o,s,s,n);r.push(...l.ops)}}return{type:"fillSketch",ops:r}}}const c={};class u{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const d=7,g=7,p=6,m=6,x=1,y=1,b=2,v=2,w=2,k=2,M=4,S=4,z=4,L=4,O=2,R=2,A=1,T=1,P=0,E=0,I={randOffset:function(t,e){return G(t,e)},randOffsetWithRange:function(t,e,n){return q(t,e,n)},ellipse:function(t,e,n,r,i){const s=C(n,r,i);return H(t,e,i,s).opset},doubleLineOps:function(t,e,n,r,i){return X(t,e,n,r,i,!0)}};function F(t,e,n,r,i){return{type:"path",ops:X(t,e,n,r,i)}}function D(t,e,n){const r=(t||[]).length;if(r>2){const i=[];for(let e=0;e<r-1;e++)i.push(...X(t[e][0],t[e][1],t[e+1][0],t[e+1][1],n));return e&&i.push(...X(t[r-1][0],t[r-1][1],t[0][0],t[0][1],n)),{type:"path",ops:i}}return 2===r?F(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}function W(t,e,n,r,i){return function(t,e){return D(t,!0,e)}([[t,e],[t+n,e],[t+n,e+r],[t,e+r]],i)}function C(t,e,n){const r=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),i=Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*r),s=2*Math.PI/i;let a=Math.abs(t/2),h=Math.abs(e/2);const o=1-n.curveFitting;return{increment:s,rx:a+=G(a*o,n),ry:h+=G(h*o,n)}}function H(t,e,n,r){const[i,s]=Z(r.increment,t,e,r.rx,r.ry,1,r.increment*q(.1,q(.4,1,n),n),n);let a=j(i,null,n);if(!n.disableMultiStroke){const[i]=Z(r.increment,t,e,r.rx,r.ry,1.5,0,n),s=j(i,null,n);a=a.concat(s)}return{estimatedPoints:s,opset:{type:"path",ops:a}}}function K(t,e){const n=[];if(t.length){const r=e.maxRandomnessOffset||0,i=t.length;if(i>2){n.push({op:"move",data:[t[0][0]+G(r,e),t[0][1]+G(r,e)]});for(let s=1;s<i;s++)n.push({op:"lineTo",data:[t[s][0]+G(r,e),t[s][1]+G(r,e)]})}}return{type:"fillPath",ops:n}}function _(t,e){return function(t,e){let n=t.fillStyle||"hachure";if(!c[n])switch(n){case"zigzag":c[n]||(c[n]=new l(e));break;case"dots":c[n]||(c[n]=new f(e));break;case"hachure":default:c[n="hachure"]||(c[n]=new o(e))}return c[n]}(e,I).fillPolygon(t,e)}function B(t){return t.randomizer||(t.randomizer=new u(t.seed||0)),t.randomizer.next()}function q(t,e,n,r=1){return n.roughness*r*(B(n)*(e-t)+t)}function G(t,e,n=1){return q(-t,t,e,n)}function X(t,e,n,r,i,s=!1){const a=s?i.disableMultiStrokeFill:i.disableMultiStroke,h=N(t,e,n,r,i,!0,!1);if(a)return h;const o=N(t,e,n,r,i,!0,!0);return h.concat(o)}function N(t,e,n,r,i,s,a){const h=Math.pow(t-n,2)+Math.pow(e-r,2),o=Math.sqrt(h);let l=1;l=o<200?1:o>500?.4:-.0016668*o+1.233334;let f=i.maxRandomnessOffset||0;f*f*100>h&&(f=o/10);const c=f/2,u=.2+.2*B(i);let d=i.bowing*i.maxRandomnessOffset*(r-e)/200,g=i.bowing*i.maxRandomnessOffset*(t-n)/200;d=G(d,i,l),g=G(g,i,l);const p=[],m=()=>G(c,i,l),x=()=>G(f,i,l);return s&&(a?p.push({op:"move",data:[t+m(),e+m()]}):p.push({op:"move",data:[t+G(f,i,l),e+G(f,i,l)]})),a?p.push({op:"bcurveTo",data:[d+t+(n-t)*u+m(),g+e+(r-e)*u+m(),d+t+2*(n-t)*u+m(),g+e+2*(r-e)*u+m(),n+m(),r+m()]}):p.push({op:"bcurveTo",data:[d+t+(n-t)*u+x(),g+e+(r-e)*u+x(),d+t+2*(n-t)*u+x(),g+e+2*(r-e)*u+x(),n+x(),r+x()]}),p}function U(t,e,n){const r=[];r.push([t[0][0]+G(e,n),t[0][1]+G(e,n)]),r.push([t[0][0]+G(e,n),t[0][1]+G(e,n)]);for(let i=1;i<t.length;i++)r.push([t[i][0]+G(e,n),t[i][1]+G(e,n)]),i===t.length-1&&r.push([t[i][0]+G(e,n),t[i][1]+G(e,n)]);return j(r,null,n)}function j(t,e,n){const r=t.length,i=[];if(r>3){const s=[],a=1-n.curveTightness;i.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<r;e++){const n=t[e];s[0]=[n[0],n[1]],s[1]=[n[0]+(a*t[e+1][0]-a*t[e-1][0])/6,n[1]+(a*t[e+1][1]-a*t[e-1][1])/6],s[2]=[t[e+1][0]+(a*t[e][0]-a*t[e+2][0])/6,t[e+1][1]+(a*t[e][1]-a*t[e+2][1])/6],s[3]=[t[e+1][0],t[e+1][1]],i.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[3][0],s[3][1]]})}if(e&&2===e.length){const t=n.maxRandomnessOffset;i.push({op:"lineTo",data:[e[0]+G(t,n),e[1]+G(t,n)]})}}else 3===r?(i.push({op:"move",data:[t[1][0],t[1][1]]}),i.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===r&&i.push(...X(t[0][0],t[0][1],t[1][0],t[1][1],n));return i}function Z(t,e,n,r,i,s,a,h){const o=[],l=[],f=G(.5,h)-Math.PI/2;l.push([G(s,h)+e+.9*r*Math.cos(f-t),G(s,h)+n+.9*i*Math.sin(f-t)]);for(let a=f;a<2*Math.PI+f-.01;a+=t){const t=[G(s,h)+e+r*Math.cos(a),G(s,h)+n+i*Math.sin(a)];o.push(t),l.push(t)}return l.push([G(s,h)+e+r*Math.cos(f+2*Math.PI+.5*a),G(s,h)+n+i*Math.sin(f+2*Math.PI+.5*a)]),l.push([G(s,h)+e+.98*r*Math.cos(f+a),G(s,h)+n+.98*i*Math.sin(f+a)]),l.push([G(s,h)+e+.9*r*Math.cos(f+.5*a),G(s,h)+n+.9*i*Math.sin(f+.5*a)]),[l,o]}function Q(t,e,n,r,i,s,a,h,o){const l=s+G(.1,o),f=[];f.push([G(h,o)+e+.9*r*Math.cos(l-t),G(h,o)+n+.9*i*Math.sin(l-t)]);for(let s=l;s<=a;s+=t)f.push([G(h,o)+e+r*Math.cos(s),G(h,o)+n+i*Math.sin(s)]);return f.push([e+r*Math.cos(a),n+i*Math.sin(a)]),f.push([e+r*Math.cos(a),n+i*Math.sin(a)]),j(f,null,o)}function V(t){return[...t]}function Y(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function J(t,e,n){const r=Y(e,n);if(0===r)return Y(t,e);let i=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return Y(t,$(e,n,i=Math.max(0,Math.min(1,i))))}function $(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function tt(t,e,n,r){const i=r||[];if(function(t,e){const n=t[e+0],r=t[e+1],i=t[e+2],s=t[e+3];let a=3*r[0]-2*n[0]-s[0];a*=a;let h=3*r[1]-2*n[1]-s[1];h*=h;let o=3*i[0]-2*s[0]-n[0];o*=o;let l=3*i[1]-2*s[1]-n[1];return a<o&&(a=o),h<(l*=l)&&(h=l),a+h}(t,e)<n){const n=t[e+0];i.length?(s=i[i.length-1],a=n,Math.sqrt(Y(s,a))>1&&i.push(n)):i.push(n),i.push(t[e+3])}else{const r=.5,s=t[e+0],a=t[e+1],h=t[e+2],o=t[e+3],l=$(s,a,r),f=$(a,h,r),c=$(h,o,r),u=$(l,f,r),d=$(f,c,r),g=$(u,d,r);tt([s,l,u,g],0,n,i),tt([g,d,c,o],0,n,i)}var s,a;return i}function et(t,e){return nt(t,0,t.length,e)}function nt(t,e,n,r,i){const s=i||[],a=t[e],h=t[n-1];let o=0,l=1;for(let r=e+1;r<n-1;++r){const e=J(t[r],a,h);e>o&&(o=e,l=r)}return Math.sqrt(o)>r?(nt(t,e,l+1,r,s),nt(t,l,n,r,s)):(s.length||s.push(a),s.push(h)),s}function rt(t,e=.15,n){const r=[],i=(t.length-1)/3;for(let n=0;n<i;n++)tt(t,3*n,e,r);return n&&n>0?nt(r,0,r.length,n):r}const it="none";class st{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,combineNestedSvgPaths:!1,disableMultiStroke:!1,disableMultiStrokeFill:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}line(t,e,n,r,i){const s=this._o(i);return this._d("line",[F(t,e,n,r,s)],s)}rectangle(t,e,n,r,i){const s=this._o(i),a=[],h=W(t,e,n,r,s);if(s.fill){const i=[[t,e],[t+n,e],[t+n,e+r],[t,e+r]];"solid"===s.fillStyle?a.push(K(i,s)):a.push(_(i,s))}return s.stroke!==it&&a.push(h),this._d("rectangle",a,s)}ellipse(t,e,n,r,i){const s=this._o(i),a=[],h=C(n,r,s),o=H(t,e,s,h);if(s.fill)if("solid"===s.fillStyle){const n=H(t,e,s,h).opset;n.type="fillPath",a.push(n)}else a.push(_(o.estimatedPoints,s));return s.stroke!==it&&a.push(o.opset),this._d("ellipse",a,s)}circle(t,e,n,r){const i=this.ellipse(t,e,n,n,r);return i.shape="circle",i}polygon(t,e){const n=this._o(e),r=[],i=D(t,!0,n);return n.fill&&("solid"===n.fillStyle?r.push(K(t,n)):r.push(_(t,n))),n.stroke!==it&&r.push(i),this._d("polygon",r,n)}}class at{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new st(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),r=this.ctx;for(const i of e)switch(i.type){case"path":r.save(),r.strokeStyle="none"===n.stroke?"transparent":n.stroke,r.lineWidth=n.strokeWidth,n.strokeLineDash&&r.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(r.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(r,i),r.restore();break;case"fillPath":r.save(),r.fillStyle=n.fill||"";const e="curve"===t.shape||"polygon"===t.shape?"evenodd":"nonzero";this._drawToContext(r,i,e),r.restore();break;case"fillSketch":this.fillSketch(r,i,n)}}fillSketch(t,e,n){let r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,this._drawToContext(t,e),t.restore()}_drawToContext(t,e,n="nonzero"){t.beginPath();for(const n of e.ops){const e=n.data;switch(n.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(n):t.stroke()}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,r,i){const s=this.gen.line(t,e,n,r,i);return this.draw(s),s}rectangle(t,e,n,r,i){const s=this.gen.rectangle(t,e,n,r,i);return this.draw(s),s}ellipse(t,e,n,r,i){const s=this.gen.ellipse(t,e,n,r,i);return this.draw(s),s}circle(t,e,n,r){const i=this.gen.circle(t,e,n,r);return this.draw(i),i}}return{canvas:(t,e)=>new at(t,e),generator:t=>new st(t),newSeed:()=>st.newSeed()}}();zzfxV=.15,zzfx=((t=1,e=.05,n=220,r=0,i=0,s=.1,a=0,h=1,o=0,l=0,f=0,c=0,u=0,d=0,g=0,p=0,m=0,x=1,y=0,b=0)=>{let v=2*Math.PI,w=o*=500*v/zzfxR**2,k=(0<g?1:-1)*v/4,M=n*=(1+2*e*Math.random()-e)*v/zzfxR,S=[],z=0,L=0,O=0,R=1,A=0,T=0,P=0,E,I;for(r=99+zzfxR*r,y*=zzfxR,i*=zzfxR,s*=zzfxR,m*=zzfxR,l*=500*v/zzfxR**3,g*=v/zzfxR,f*=v/zzfxR,c*=zzfxR,u=zzfxR*u|0,I=r+y+i+s+m|0;O<I;S[O++]=P)++T%(100*p|0)||(P=a?1<a?2<a?3<a?Math.sin((z%v)**3):Math.max(Math.min(Math.tan(z),1),-1):1-(2*z/v%2+2)%2:1-4*Math.abs(Math.round(z/v)-z/v):Math.sin(z),P=(u?1-b+b*Math.sin(2*Math.PI*O/u):1)*(0<P?1:-1)*Math.abs(P)**h*t*.15*(O<r?O/r:O<r+y?1-(O-r)/y*(1-x):O<r+y+i?x:O<I-m?(I-O-m)/s*x:0),P=m?P/2+(m>O?0:(O<I-m?1:(I-O)/m)*S[O-m|0]/2):P),z+=(E=(n+=o+=l)*Math.sin(L*g-k))-E*d*(1-1e9*(Math.sin(O)+1)%2),L+=E-E*d*(1-1e9*(Math.sin(O)**2+1)%2),R&&++R>c&&(n+=f,M+=f,R=0),!u||++A%u||(n=M,o=w,R=R||1);return(t=zzfxX.createBuffer(1,I,zzfxR)).getChannelData(0).set(S),(n=zzfxX.createBufferSource()).buffer=t,n.connect(zzfxX.destination),n.start(),n}),zzfxX=new(window.AudioContext||webkitAudioContext),zzfxR=44100;var h=[];h.push([{gates:[1,3,6,12,15],levelSpread:[1,5,10,17],yOff:-2},"##########.","p1g.1.1.1.g","##########.","2.2.2.2.2.g","##########.",".333.3333.g","##########.","4.4.4.4g4#."]),h.push([{nr:100,name:"A Wrapping World"},"#####.#","......#","...#..#","#.###.#",".b#t.p.","..###.#"]),h.push([{nr:101,name:"Infinite Inlet"},"..#","p.#",".tbt","#b.b",".tbt"]),h.push([{nr:102,name:"Glass Hallway"},"##.##",".t.tp","bb#bb",".t.t","##.##"]),h.push([{nr:103,name:"Girded Grid"},".#.#.#","t.b.t",".#.#.#","b.p.b",".#.#.#","t.b.t"]),h.push([{nr:200,name:"Wrap Around The Block",yOff:2},"","####","","####","..b","####","t#.p","####"]),h.push([{nr:201,name:"Crowned Conundrum",xOff:3},"pb...b","b#.#.#",".#ttt#"]),h.push([{nr:202,name:"Twisted Terrace",xOff:3},"b..p",".##.##",".#.t.#","bbt#tb",".#.t.#",".##.##"]),h.push([{nr:203,name:"Continuous Corridor",yOff:3},"######","tb..p","t....b","######","t#...b","tb...#"]),h.push([{nr:204,name:"Grandiose Garden",yOff:3},"..bpb","..#.#",".#.t.#",".bt.tb",".#.t.#","..#.#"]),h.push([{nr:300,name:"Sift & Shift"},"bt##|#","###p","####.#"]),h.push([{nr:301,name:"Cornered Contraption",yOff:1},"p",".|","#####",".t#","###"]),h.push([{nr:302,name:"Zealous Zigzag"},"#t#t#t",".-..-","###..#",".p####",".-"]),h.push([{nr:303,name:"Irregular Infrastructure",yOff:2},"##.|",".#..p",".#..#",".#.#t","....#",""]),h.push([{nr:304,name:"Enchanted Encagement"},"##.#.###.#.#","#..-..#....#","#..p..#.t.t","#..-..##","##.#.###.#.#"]),h.push([{nr:305,name:"Riddle Raster",yOff:-1},"",".t","#|#",".t","#b#","pt","#|#"]),h.push([{nr:306,name:"Locked Loungerooms",yOff:-2},"#########","####..###",".......##","####....#","####","....#...#","#....#","...||.###","##.p","tt#...###"]),h.push([{nr:400,name:"Rubble Rundown"},"rrr#..r#",".pb...r#","#t######"]),h.push([{nr:401,name:"Quality Questions",yOff:-2},"rrrrrrr","#t|#|t#","#|t#t|#","rrrprrr","#######","rrrrrrr","#t#|#t#","#|#t#|#","rrrrrrr","#######"]),h.push([{nr:402,name:"Swirling Stars"},"....#r+tr","b##..r.rb","b.##..r.b","..t...p","#ttt#rrr#"]),h.push([{nr:403,name:"Box Breakout"},"b.#.#.b",".#rpr#","#rrtrr#","...+","#rrtrr#","q#r.r#q","bq#.#.b"]),h.push([{nr:404,name:"Edge Not Found",autoX:1},"","#.#.###.#.#","#p#.#.#.#t#","###.#.#.###","..#.###...#"]);const o=Math,l="px sans-serif";var f=70,c=1;const u=new t(.1,1/60),d=document.getElementById("canvas"),g=d.getContext("2d",{alpha:!1}),p=a.canvas(d),m=document.createElement("canvas"),x=m.getContext("2d"),y=a.canvas(m),b=document.createElement("canvas"),v=b.getContext("2d"),w=a.canvas(b),k=10,M=document.createElement("canvas"),S=M.getContext("2d"),z=a.canvas(M),L=document.createElement("canvas"),O=L.getContext("2d"),R=a.canvas(L),A=10,T=document.createElement("canvas"),P=T.getContext("2d"),E=a.canvas(T),I=15,F=document.createElement("canvas"),D=F.getContext("2d"),W=a.canvas(F),C=15;let H=[];var K=0,_=0,B="Edge Not Found ",q="Press any key",G="",X=0,N=0,U=0,j=0,Z=0,Q=0;onkeydown=function(t){"ArrowDown"!=t.key&&"ArrowUp"!=t.key&&" "!=t.key&&"Backspace"!=t.key||t.preventDefault(),Qt(t)},window.onbeforeunload=function(){return"Quit?"};var V=null,Y=!1;onload=function(t){V=document.querySelector('link[rel="icon"]')};var J=0,$=h[J].length,tt=h[J][0].length,et={x:0,y:0},nt=[],rt=[],it=[],st=[],at=[],ht=[],ot="",lt=0,ft=0,ct=0,ut=.1,dt=1/3,gt=dt,pt=4,mt=1,xt=pt,yt=0,bt=1,vt=.2,wt=0,kt=.075,Mt=0,St=.2,zt=0,Lt=.25,Ot=Lt,Rt=!1,At=0,Tt=!0,Pt=new n(["KeyS","ArrowDown"],["KeyW","ArrowUp"],u,.1,.2),Et=new n(["KeyD","ArrowRight"],["KeyA","ArrowLeft"],u,.1,.2),It=new n(["KeyZ","Backspace"],[],u,.1,.2),Ft=new n(["KeyX","Space","Enter"],[],u,.1,.2),Dt=!1,Wt=[];Wt[0]=["Sketchbook","#ffffff","#000000","#808080","#ff0000"],Wt[1]=["Scratchpad","#202020","#ffffff","#808080","#ffd700"],Wt[2]=["Golden Ticket","#303030","#b29700","#8e7900","#efe7d6"],Wt[3]=["Ikaniko","#1E2A26","#7CA49B","#267B75","#C8EEE5"],Wt[4]=["BackFlipped","#223e32","#b3dd52","#04bf00","#A7C06D"];var Ct=0,Ht=!0,Kt=!0,_t=!1,Bt=0,qt=!0,Gt=0;window.onresize=function(){d.width=d.clientWidth,d.height=d.clientHeight,qt=!0},d.width=d.clientWidth,d.height=d.clientHeight;for(var Xt=[],Nt=0;Nt!=h.length;Nt+=1)Xt[Nt]=0;var Ut=0;function jt(){try{if(u.update(),Et.update(),Pt.update(),It.update(),Ft.update(),!_t&&!Tt)if(Rt){var t=5;if(0==J&&(t=4),Pt.fired&&1==Pt.delta)(At+=1)>=t&&(At=0);else if(Pt.fired&&-1==Pt.delta)(At-=1)<0&&(At=t-1);else if(Ft.fired)switch(At){case 0:Rt=!Rt,le(0,!0);break;case 1:(Ht=!Ht)&&le(7,!0),fe();break;case 2:Dt=!Dt,le(2,!0),fe();break;case 3:wt>=vt&&(wt=0,++Ct>=Wt.length&&(Ct=0),qt=!0,le(2,!0)),fe();break;case 4:Vt(0),le(8,!0),Rt=!Rt}}else{if(Pt.fired&&oe(0,Pt.delta),Et.fired&&oe(Et.delta,0),1==It.fired&&0!=H.length){le(5);var e=H.pop(),n;et=e.player,rt=e.boxes,X=e.xOff,N=e.yOff,ot=ot.slice(0,-1),Kt=0==ot.length||" "==ot.slice(-1),0==J&&ue(n=ne(et.x,et.y),1),ct=ut,qt=!0}var n;Ft.fired&&yt>=bt&&null!=(n=ne(et.x,et.y))&&(Bt=st[n].target,_t=!0,xt=0,le(0))}ct=o.min(ct+u.currentFrameLength,ut),gt=o.min(gt+u.currentFrameLength,dt),yt=o.min(yt+u.currentFrameLength,bt),xt=o.min(xt+u.currentFrameLength,pt),wt=o.min(wt+u.currentFrameLength,vt),Mt=o.min(Mt+u.currentFrameLength,kt),zt=o.min(zt+u.currentFrameLength,St),Ot=o.min(Ot+u.currentFrameLength,Lt),Tt&&(yt=.5*bt),f=d.width<700||d.height<700?40:d.width<1e3||d.height<900?55:70;var r=1,i=f;if(yt<bt?(r=yt/bt,i=f+20-20*ae(yt/bt)):xt<pt&&0!=J?(r=1-xt/pt,i=f-50+50*(1-ae(xt/pt))):xt<mt&&0==J?(r=1-xt/mt,i=f-20*ae(xt/mt)):(xt>=pt&&0!=J||xt>=mt&&0==J)&&_t&&(0==J?Vt(Bt):(J==h.length-1&&(B="Victory! ",q="Thank you for playing!",Tt=!0,le(9)),Vt(0)),r=0),Dt)var i=f;var s=$*i,a=tt*i,y=!1;if(!Dt&&gt>=dt||i!=Gt||qt){!Dt&&gt>=dt&&(c+=1,gt=0),y=!0,qt=!1,i!=Gt?(M.width=i,M.height=i,b.width=i+k,b.height=i+k,L.width=i+A,L.height=i+A,F.width=i+C,F.height=i+C,T.width=i+I,T.height=i+I):(S.clearRect(0,0,M.width,M.height),S.beginPath(),v.clearRect(0,0,b.width,b.height),v.beginPath(),O.clearRect(0,0,L.width,L.height),O.beginPath(),D.clearRect(0,0,F.width,F.height),D.beginPath(),P.clearRect(0,0,T.width,T.height),P.beginPath());var U=.8;z.circle(.5*i,.5*i,i*U,{fill:Wt[Ct][1],fillStyle:"solid",stroke:Wt[Ct][2],strokeWidth:1,seed:c}),w.rectangle(.5*k,.5*k,i,i,{stroke:Wt[Ct][2],fill:Wt[Ct][2],strokeWidth:1,seed:c});var U=.8;R.rectangle(.5*A+.5*(1-U)*i,.5*A+.5*(1-U)*i,i*U,i*U,{stroke:Wt[Ct][2],fill:Wt[Ct][2],strokeWidth:2,seed:c});var U=1.1;W.rectangle(.5*C+.5*(1-U)*i,.5*C+.5*(1-U)*i,i*U,i*U,{stroke:"none",fill:Wt[Ct][2],fillStyle:"dots",fillWeight:i/70,strokeWidth:2,seed:c});var U=1.1;E.circle(.5*i+.5*I,.5*i+.5*I,i*U,{fillStyle:"zigzag",fill:Wt[Ct][3],stroke:Wt[Ct][2],strokeWidth:1,seed:c})}null==V||Y||(V.href=T.toDataURL("image/png"),Y=!0);var j=0!=K||0!=_,nt=2;K>0?K=o.max(0,K-2):K<0&&(K=o.min(0,K+2)),_>0?_=o.max(0,_-2):_<0&&(_=o.min(0,_+2));var it=20;if((y||gt>=dt||ct<=2*ut||1!=r||j)&&(i!=Gt||qt?(m.width=a+20,m.height=s+20):(x.clearRect(0,0,m.width,m.height),x.beginPath()),Zt(0,0,tt,$,i),y=!0),y||Tt){var at=1;Dt&&(at=0);var ht=o.round(.5*d.width-.5*a-10+.25*K*at),lt=o.round(.5*d.height-.5*s-10+.25*_*at),ft=10,Xt=o.ceil((d.width-a+10)/a*.5),Nt=o.ceil((d.height-s+10)/s*.5);0!=X&&(Xt+=1),0!=N&&(Nt+=1);var Ut=X-Z*(1-ae(o.min(ct/ut,1))),Qt=N-Q*(1-ae(o.min(ct/ut,1)));g.globalAlpha=1,g.fillStyle=Wt[Ct][1],g.fillRect(0,0,d.width,d.height);for(let t=-Nt;t<=Nt;t++)for(let e=-Xt;e<=Xt;e++)0==e&&0==t||(g.globalAlpha=o.max(0,r-.1*o.abs(t)-o.abs(.1*e)),g.globalAlpha>0&&g.drawImage(m,ht+a*e+Ut*i*t,lt+s*t+Qt*i*e));g.globalAlpha=r,g.drawImage(m,o.round(ht+K*at),o.round(lt+_*at));const t=5;if(p.rectangle(o.round(ht-t+.5*K*at),o.round(lt-t+.5*_*at),a+t+20,s+t+20,{stroke:Wt[Ct][2],seed:c}),g.globalAlpha=1,(Tt||Rt)&&(g.globalAlpha=.4,g.fillStyle=Wt[Ct][1],g.fillRect(-1,-1,d.width+2,d.height+2),g.globalAlpha=1),Tt||(g.textAlign="left",g.font=40+l,g.globalAlpha=ae(zt/St),he(g,G,40,d.height-40),g.globalAlpha=1),g.font=22+l,g.fillStyle=Wt[Ct][1],g.textAlign="center",g.textBaseline="middle",Tt){g.font=o.round(1.2*f)+l,g.textAlign="left",g.textBaseline="center",g.fillStyle="black";var Yt=B,Jt=g.measureText(Yt).width,$t=o.ceil(d.width/Jt)+1;Yt=Yt.repeat($t);var te=0;if(!Dt)var te=u.timePlaying%5/5;he(g,Yt,-te*Jt,.5*d.height),g.font=o.round(.5*f)+l,g.textAlign="center",he(g,q,.5*d.width,.6*d.height)}else if(Rt){g.globalAlpha=1;var ee=1;if(!Dt)var ee=ae(Ot/Lt);var re=400*ee;p.rectangle(-5,-5,re+5,55+250*ee,{fill:Wt[Ct][2],fillWeight:4,stroke:"none",seed:o.round(c/2)});var ie=50,se=50*ee;g.globalAlpha=ee,p.rectangle(20,25+At*se,re-40,se,{fillStyle:"none",stroke:Wt[Ct][1],seed:c}),g.fillStyle=Wt[Ct][1],g.textAlign="center";var Yt="Audio: ";Yt+=1==Ht?"ON":"OFF",g.fillText(Yt,.5*re,50+1*se),g.fillText("[Esc] Resume",.5*re,50);var Yt="Reduce Motion: ";Yt+=1==Dt?"ON":"OFF",g.fillText(Yt,.5*re,50+2*se),Yt="Theme: "+Wt[Ct][0]+" ("+(Ct+1)+"/"+Wt.length+")",g.fillText(Yt,.5*re,50+3*se),0!=J?g.fillText("Back to Level Select",.5*re,50+4*se):(g.font=16+l,g.fillText("Game by Tom Hermans for js13k 2020",.5*re,50+3.8*se),g.fillText("rough - Copyright (c) 2019 Preet Shihn",.5*re,50+4.2*se),g.fillText("ZzFX - Copyright (c) 2019 Frank Force",.5*re,50+4.6*se)),g.globalAlpha=1}else _t||(p.rectangle(-5,-5,85,85,{fill:Wt[Ct][2],fillWeight:4,stroke:"none",seed:o.round(c/2)}),g.fillText("[Esc]",50,60),0!=J&&(g.globalAlpha=Kt?.25:1,p.rectangle(d.width-160,d.height-80,100,50,{fill:Wt[Ct][2],fillWeight:4,stroke:"none",seed:o.round(c/2)}),g.fillText("[R] Retry",d.width-110,d.height-55),H.length>0?g.globalAlpha=1:g.globalAlpha=.25,p.rectangle(d.width-280,d.height-80,100,50,{fill:Wt[Ct][2],fillWeight:4,stroke:"none",seed:o.round(c/2)+10}),g.fillText("[Z] Undo",d.width-230,d.height-55)))}Gt=i,window.requestAnimationFrame(jt)}catch(t){console.error("Whoops! The game crashed.",t)}}function Zt(t,e,n,i,s){function a(t,e){if(e(0,0),t.x<=.5){var r=(t.y+N+i)%i-t.y;e(n*s,r*s)}else if(t.x>=n-1.5){var r=(t.y-N+i)%i-t.y;e(-n*s,r*s)}var a;if(t.y<=.5)e((a=(t.x+X+n)%n-t.x)*s,i*s);else if(t.y>=i-1.5){var a;e((a=(t.x-X+n)%n-t.x)*s,-i*s)}}var f=10,u=q();if(H.length>0&&!Dt){var d,g,p=ot.length-ot.lastIndexOf(" "),m=r(H.length,1,9);m=o.min(m,p);for(var v=0;v<m;v+=1){var w=H.length-m+v;if(w<0||w>H.length)break;var S=1;w==H.length-1&&(S=ct/ut);var z=o.max(0,(v+(1-S))/m*.25),O=de(Wt[Ct][1],Wt[Ct][3],z),R={x:H[w].player.x,y:H[w].player.y},P={x:H[w].player.x,y:H[w].player.y};switch(ot[w].toLowerCase()){case"u":R.y+=.2,P.y-=1.2*S;break;case"d":R.y-=.2,P.y+=1.2*S;break;case"l":R.x+=.2,P.x-=1.2*S;break;case"r":R.x+=.2,P.x+=1.2*S}function E(t=0,e=0){y.line(j(R.x+.5)+t,Z(R.y+.5)+e,j(P.x+.5)+t,Z(P.y+.5)+e,{strokeWidth:.4*s,stroke:O,seed:c+v,roughness:.75})}a(R,E)}}for(let t=0;t!=ht.length;t++)x.drawImage(F,j(ht[t].x)-.5*C,Z(ht[t].y)-.5*C);for(let t=0;t!=it.length;t++)x.drawImage(T,j(it[t].x)-.5*I,Z(it[t].y)-.5*I);for(let t=0;t!=at.length;t++)at[t].target<=Ut?x.globalAlpha=.2:x.globalAlpha=1,x.drawImage(L,j(at[t].x)-.5*A,Z(at[t].y)-.5*A);x.globalAlpha=1;for(let t=0;t!=nt.length;t++)x.drawImage(b,j(nt[t].x)-.5*k,Z(nt[t].y)-.5*k);for(let t=0;t!=st.length;t++)x.drawImage(T,j(st[t].x)-.5*I,Z(st[t].y)-.5*I);function D(t=0,e=0){x.drawImage(M,j(u.x)+t+K,Z(u.y)+e+_)}a(et,D);for(let t=0;t!=rt.length;t++){var W=G(t);function B(e=0,n=0){x.drawImage(L,j(W.x)-.5*A+e,Z(W.y)-.5*A+n),1!=rt[t].shift&&3!=rt[t].shift||y.line(j(W.x)+.2*s+e,Z(W.y)+.5*s+n,j(W.x)+.8*s+e,Z(W.y)+.5*s+n,{stroke:Wt[Ct][4],strokeWidth:s/7,seed:c}),2!=rt[t].shift&&3!=rt[t].shift||y.line(j(W.x)+.5*s+e,Z(W.y)+.2*s+n,j(W.x)+.5*s+e,Z(W.y)+.8*s+n,{stroke:Wt[Ct][4],strokeWidth:s/7,seed:c})}a(rt[t],B)}x.textAlign="center",x.textBaseline="middle",x.fillStyle=Wt[Ct][2];for(let t=0;t!=st.length;t++)x.font=o.round(.5*s)+l,x.fillText(h[st[t].target][0].nr.toString(),j(st[t].x)+.5*T.width-.5*I,Z(st[t].y)-.5*I+.5*T.height),2==Xt[t+1]?(x.font=o.round(.4*s)+l,x.fillText("✓",j(st[t].x)+.75*T.width-.5*I,Z(st[t].y)-.5*I+.75*T.height)):0==Xt[t+1]&&(x.font="bold "+o.round(.25*s)+l,x.fillText("!",j(st[t].x)+.5*T.width-.5*I,Z(st[t].y)-.5*I+.8*T.height));x.font=o.round(.4*s)+l,x.textAlign="center",x.textBaseline="middle",x.fillStyle=Wt[Ct][2];for(let t=0;t!=at.length;t++)at[t].target<=Ut?x.globalAlpha=.2:x.globalAlpha=1,he(x,Ut+"/"+at[t].target,j(at[t].x)+.5*L.width-.5*A,Z(at[t].y)-.5*A+.5*L.height);function q(){if(H.length>0){var t,e=H[H.length-1].player;return U(et,e)}return{x:et.x,y:et.y}}function G(t){if(H.length>0){var e,n=H[H.length-1].boxes[t];return U(rt[t],n)}return{x:rt[t].x,y:rt[t].y}}function U(t,e){var s=1-r(ct/ut,0,1);if(0!=s){var a=o.round(t.x-e.x),h=o.round(t.y-e.y);return 0!=a&&0!=h?0!=lt?(a-=o.sign(a)*n,h=0):(h-=o.sign(h)*i,a=0):o.abs(a)>1?a-=o.sign(a)*n:o.abs(h)>1&&(h-=o.sign(h)*i),s=ae(s),{x:t.x-a*s,y:t.y-h*s}}return{x:t.x,y:t.y}}function j(e){return t+f+e*s}function Z(t){return e+f+t*s}x.globalAlpha=1}function Qt(t){if(!_t){if(Tt)return le(0,!0),void(Tt=!1);var e=t.key;if(qt=!0,"Escape"==e&&Ot>=.1&&(le((Rt=!Rt)?7:0,!0),Ot=0,At=0),!Rt){if("r"==e||"R"==e)return void(Kt||(le(6),H.push({player:et,boxes:rt.slice(),xOff:X,yOff:N}),Vt(J,!1)));if(t.shiftKey&&"n"==e||"N"==e)return void Vt(o.min(J+1,h.length-1));if(t.shiftKey&&"b"==e||"B"==e)return void Vt(o.max(J-1,0))}}}function Vt(t,e=!0){J=t;var n=h[t].slice(),r=n.shift();0==Xt[J]&&(Xt[J]=1,fe()),et={x:0,y:0},nt.length=0,rt.length=0,it.length=0,st.length=0,ht.length=0,at.length=0,K=0,_=0,Kt=!0,_t=!1,ue(J),2==Xt[J]&&0!=J&&(G+=" ✓"),X=r.xOff?r.xOff:0,N=r.yOff?r.yOff:0,U=r.autoX?r.autoX:0,j=r.autoY?r.autoX:0;var i=!1,s=null;if(r.levelSpread)var s=r.levelSpread.slice();var a=0;function l(t,e,n){n!=Bt||i||(et={x:t,y:e},i=!0,G=h[Bt][0].nr+": "+h[Bt][0].name+" - [Space] to enter",zt=0)}$=n.length,tt=0;for(let t=0;t<$;t++){tt=o.max(tt,n[t].length);for(let e=0;e<n[t].length;e++){var f;switch(n[t].substring(e,e+1).toLowerCase()){case"p":i||(et={x:e,y:t});break;case"#":nt.push({x:e,y:t});break;case"b":rt.push({x:e,y:t,shift:0});break;case"-":rt.push({x:e,y:t,shift:1});break;case"|":rt.push({x:e,y:t,shift:2});break;case"+":rt.push({x:e,y:t,shift:3});break;case"t":it.push({x:e,y:t});break;case"1":st.push({x:e,y:t,target:s[0]}),l(e,t,s[0]),s[0]++;break;case"2":if(Ut<r.gates[1]){it.push({x:e,y:t});break}st.push({x:e,y:t,target:s[1]}),l(e,t,s[1]),s[1]++;break;case"3":if(Ut<r.gates[2]){it.push({x:e,y:t});break}st.push({x:e,y:t,target:s[2]}),l(e,t,s[2]),s[2]++;break;case"4":if(Ut<r.gates[3]){it.push({x:e,y:t});break}st.push({x:e,y:t,target:s[3]}),l(e,t,s[3]),s[3]++;break;case"r":ht.push({x:e,y:t});break;case"g":at.push({x:e,y:t,target:r.gates[a]}),a++}}}e?(H=[],ot="",yt=0,xt=pt):ot+=" "}function Yt(t,e){function n(){return t>=tt?(t-=tt,e-=N,!0):t<0&&(t+=tt,e+=N,!0)}function r(){return e>=$?(e-=$,t-=X,!0):e<0&&(e+=$,t+=X,!0)}var i=n();return r(),i||n(),{x:t,y:e}}function Jt(t,e,n){for(let r=0;r!=t.length;r++)if(t[r].x==e&&t[r].y==n)return r;return null}function $t(t,e){return Jt(nt,t,e)}function te(t,e){return Jt(rt,t,e)}function ee(t,e){return Jt(it,t,e)}function ne(t,e){return Jt(st,t,e)}function re(t,e){return Jt(ht,t,e)}function ie(t,e){var n=Jt(at,t,e);return null!=at[n]&&at[n].target<=Ut?null:n}function se(t){return t%2==0}function ae(t){return t*(2-t)}function he(t,e,n,r){t.miterLimit=2,t.strokeStyle=Wt[Ct][2],t.lineWidth=8,t.strokeText(e,n,r),t.fillStyle=Wt[Ct][1],t.fillText(e,n,r)}function oe(t,e){var n="";if(-1==t)n="l";else if(1==t)n="r";else if(1==e)n="d";else{if(-1!=e)return;n="u"}if(0!=t||0!=e){H.push({player:et,boxes:rt.slice(),xOff:X,yOff:N});var r=!1,i=!1;Z=0,Q=0;var s=Yt(et.x+t,et.y+e),a=s.x,h=s.y;let n=te(a,h);if(null!==n){var o=Yt(a+t,h+e);let s=o.x,l=o.y;null===$t(s,l)&&null===te(s,l)&&null===re(s,l)&&(rt[n]={x:s,y:l,shift:rt[n].shift},et={x:a,y:h},r=!0,i=!0,0!=rt[n].shift&&(1!=rt[n].shift&&3!=rt[n].shift||c(t),2!=rt[n].shift&&3!=rt[n].shift||u(e)))}else null===$t(a,h)&&null===ie(a,h)&&(et={x:a,y:h},r=!0)}if(r){var l;ot+=i?n.toUpperCase():n,ct=0,lt=t,ft=e,Kt=!1,0==J&&ue(ne(et.x,et.y),1),U?c(U):j&&u(j);var f=!0;if(i&&it.length>0){for(let t=0;t!=it.length;t++)if(null===te(it[t].x,it[t].y)){f=!1;break}}else f=!1;f?(2!=Xt[J]&&(Xt[J]=2,Ut++),fe(),le(4,!0),_t=!0,xt=0):le(i?0!=Z||0!=Q?3:10:2)}else 0==t&&0==e||(le(1),H.pop()),K=12*t,_=12*e;function c(t){0==N&&(Z=-t,ct=0,(X-=t)>=.5*tt?X-=tt:X<=.5*-tt&&(X+=tt))}function u(t){0==X&&(Q=-t,ct=0,(N-=t)>=.5*$?N-=$:N<=.5*-$&&(N+=$))}}function le(t,e=!1){if(Ht&&(Mt>=kt||e))switch(e||(Mt=0),t){case 0:zzfx(...[,.3,176,.02,,.08,3,.4,-.7,-21,-127,.01,.05,,,,.38,,.03]);break;case 1:zzfx(...[,.3,220,.02,,.08,3,.4,-.7,-21,-127,.01,.05,,,,.38,,.03]);case 2:zzfx(...[.6,.1,176,.02,,.01,3,.4,-.7,-21,-127,.01,.05,,,,.1,,.02]);break;case 10:zzfx(...[.5,.1,220,.02,,.01,3,.4,-.7,-21,-127,.01,.05,,,,.1,,.02]);break;case 3:zzfx(...[.45,.1,250,.02,,.01,3,.4,-.7,-21,-127,.01,.05,,,.1,.1,,.02]);break;case 4:zzfx(...[.6,,934,.12,.38,.93,1,.27,,.4,-434,.08,.2,.1,,.1,.17,.55,1,.46]);break;case 5:zzfx(...[,,110,,,,1,1.82,,.1,,,,.1,,.1,.01,.7,.02,.15]);break;case 6:zzfx(...[,,283,.02,,.11,,.38,,,,,.07,,,.1,.08,.63,.02]);break;case 7:zzfx(...[,.02,1638,,.05,.17,1,,,,490,.09,,,,.1,.05,.5,.03]);break;case 8:zzfx(...[,,98,.08,.18,.02,2,2.47,36,.5,,,.04,.1,,.9,.44,,.04]);break;case 9:zzfx(...[,,525,.18,.28,.17,1,1.24,8.3,-9.7,-151,.03,.06,,,,,.93,.02,.14])}}function fe(){for(var t=window.localStorage,e="",n=1;n!=Xt.length;n+=1)2==Xt[n]?e+="t":1==Xt[n]?e+="f":e+="n";t.setItem("enf-l",e),t.setItem("enf-c",Ct),t.setItem("enf-a",Ht),t.setItem("enf-r",Dt),t.setItem("enf-v",1)}function ce(){var t=window.localStorage,e,e,e;if(null!=(e=t.getItem("enf-l")))for(var n=1;n!=Xt.length;n+=1)"t"==e[n-1]?(Xt[n]=2,Ut++):"f"==e[n-1]&&(Xt[n]=1);(e=parseInt(t.getItem("enf-c",0)))>=0&&e<Wt.length&&(Ct=e),"false"==(e=t.getItem("enf-a"))&&(Ht=!1);var e=t.getItem("enf-r");Dt="true"==e}function ue(t,e=0){var n=G;0==J||Xt.includes(2)?null!=t&&t+e!=0?(G=h[t+e][0].nr+": "+h[t+e][0].name,0==J&&(G+=" - [Space] to enter")):G=Xt.includes(2)?"":"WASD/Arrow Keys to move":G="Push the box to the goal!",n!=G&&(zt=0)}function de(t,e,n){const[r,i,s]=t.match(/\w\w/g).map(t=>parseInt(t,16)),[a,h,l]=e.match(/\w\w/g).map(t=>parseInt(t,16)),f=o.round(r+(a-r)*n).toString(16).padStart(2,"0"),c=o.round(i+(h-i)*n).toString(16).padStart(2,"0"),u=o.round(s+(l-s)*n).toString(16).padStart(2,"0");return"#"+f+c+u}ce(),Vt(J),window.requestAnimationFrame(jt);